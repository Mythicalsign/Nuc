name: Nuclei scan over Tor (SOCKS5)

on:
  workflow_dispatch:
  # push: { branches: [ main ] }   # uncomment if you want push trigger

jobs:
  tor-scan:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-go@v5
        with: { go-version: 'stable' }

      - name: Install Tor & nuclei
        run: |
          sudo apt-get update
          sudo apt-get install -y tor
          go install -v github.com/projectdiscovery/nuclei/v3/cmd/nuclei@latest
          nuclei -update-templates

      - name: Start Tor service
        run: |
          sudo systemctl start tor
          sleep 5           # give Tor time to bootstrap
          curl --socks5 127.0.0.1:9055 https://check.torproject.org/api/ip  # quick check

      - name: Run Nuclei through Tor
        run: |
          nuclei \
            -u "https://fetena.net" \
            -jsonl -o nuclei.jsonl \
            -json-export nuclei.json \
            -severity critical,high,medium \
            -rl 30 -c 10 -timeout 15 -retries 2 \
            -H "User-Agent: Nuclei-GHA/1.0" \
            -proxy socks5://127.0.0.1:9050 \
            -stats

      - name: Upload reports
        uses: actions/upload-artifact@v4
        with:
          name: nuclei-tor-reports
          path: |
            nuclei.json
            nuclei.jsonl
          retention-days: 30
